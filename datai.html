<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R basics for Research - 3&nbsp; Data Wrangling with Tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./vizi.html" rel="next">
<link href="./start.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Wrangling with Tidyverse</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R basics for Research</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Setting things up</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started with R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datai.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Wrangling with Tidyverse</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vizi.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with Tidyverse</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#select-arrange-group_by-and-summarize" id="toc-select-arrange-group_by-and-summarize" class="nav-link active" data-scroll-target="#select-arrange-group_by-and-summarize"> <span class="header-section-number">3.1</span> select(), arrange(), group_by(), and summarize()</a></li>
  <li><a href="#filter-mutate-and-ifelse" id="toc-filter-mutate-and-ifelse" class="nav-link" data-scroll-target="#filter-mutate-and-ifelse"> <span class="header-section-number">3.2</span> filter(), mutate(), and ifelse()</a></li>
  <li><a href="#exercise-i-racial-discrimination-in-the-labor-market" id="toc-exercise-i-racial-discrimination-in-the-labor-market" class="nav-link" data-scroll-target="#exercise-i-racial-discrimination-in-the-labor-market"> <span class="header-section-number">3.3</span> Exercise I: <strong>Racial Discrimination in the Labor Market</strong></a></li>
  <li><a href="#exercise-ii-the-tennessee-star-experiment" id="toc-exercise-ii-the-tennessee-star-experiment" class="nav-link" data-scroll-target="#exercise-ii-the-tennessee-star-experiment"> <span class="header-section-number">3.4</span> Exercise II: <strong>The Tennessee STAR experiment</strong></a></li>
  <li><a href="#merging-datasets" id="toc-merging-datasets" class="nav-link" data-scroll-target="#merging-datasets"> <span class="header-section-number">3.5</span> Merging datasets</a></li>
  <li><a href="#drop_na-and-replace_na" id="toc-drop_na-and-replace_na" class="nav-link" data-scroll-target="#drop_na-and-replace_na"> <span class="header-section-number">3.6</span> drop_na() and replace_na()</a></li>
  <li><a href="#exercise-iii-in-and-notin-more-summarize" id="toc-exercise-iii-in-and-notin-more-summarize" class="nav-link" data-scroll-target="#exercise-iii-in-and-notin-more-summarize"> <span class="header-section-number">3.7</span> Exercise III: <code>%in%</code> and <code>%notin%</code> more summarize()</a></li>
  <li><a href="#group_by-and-ungroup" id="toc-group_by-and-ungroup" class="nav-link" data-scroll-target="#group_by-and-ungroup"> <span class="header-section-number">3.8</span> group_by() and ungroup()</a></li>
  <li><a href="#exercise-iv-airbnb-and-chicago-communities" id="toc-exercise-iv-airbnb-and-chicago-communities" class="nav-link" data-scroll-target="#exercise-iv-airbnb-and-chicago-communities"> <span class="header-section-number">3.9</span> Exercise IV: Airbnb and Chicago Communities</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Wrangling with Tidyverse</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Tidyverse is a collection of packages that helps you with data management and visualization. Let’s keep playing with the Rand HIE data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>rand_sample<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"rand_sample.RDS"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>rand_spend<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"rand_spend.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also check the dataset using the function <code>glimpse()</code> (tidyverse package). Then you have a good look at all the 319 columns in this dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="do">## don't forget to load tidyverse before using its functions</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>rand_sample<span class="sc">%&gt;%</span><span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="select-arrange-group_by-and-summarize" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="select-arrange-group_by-and-summarize"><span class="header-section-number">3.1</span> select(), arrange(), group_by(), and summarize()</h2>
<p>Let’s say you want to compare demographic characteristics of the individuals in the RAND HIE across health insurance groups. To do that, you just need the functions <code>group_by()</code> and <code>summarize()</code> from the <code>tidyverse</code> package. Since there are some missing observations (NA), allow the function mean() to ignore those NAs.</p>
<p>Before doing that, let’s first select the columns <code>plantype</code> (assigned insurance) <code>female</code> (1 if female, 0 otherwise) <code>blackhisp</code> (1 if black or hispanic, 0 otherwise) <code>age</code>, <code>educper</code> (education), and <code>income1cpi</code> (income).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sub_data<span class="ot">&lt;-</span>rand_sample<span class="sc">%&gt;%</span><span class="fu">select</span>(plantype, female, blackhisp, age, educper, income1cpi)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">## check the new dataframe with View(sub_data)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, using <code>sub_data</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sub_data<span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(plantype)<span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Female=</span><span class="fu">mean</span>(female, <span class="at">na.rm=</span>T), </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nonwhite=</span><span class="fu">mean</span>(blackhisp, <span class="at">na.rm=</span>T),              <span class="at">Age=</span><span class="fu">mean</span>(age, <span class="at">na.rm=</span>T), </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Education=</span><span class="fu">mean</span>(educper, <span class="at">na.rm=</span>T), </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Family Income</span><span class="st">`</span><span class="ot">=</span><span class="fu">mean</span>(income1cpi, <span class="at">na.rm=</span>T),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Number enrolled</span><span class="st">`</span><span class="ot">=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  plantype     Female Nonwhite   Age Education `Family Income` `Number enrolled`
  &lt;fct&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;           &lt;dbl&gt;             &lt;int&gt;
1 Catastrophic  0.560    0.172  32.4      12.1          31603.               759
2 Deductible    0.537    0.153  32.9      11.9          29499.               881
3 Coinsurance   0.535    0.145  33.3      12.0          32573.              1022
4 Free          0.522    0.144  32.8      11.8          30627.              1295</code></pre>
</div>
</div>
<p>The function <code>arrange()</code> allows you arrange values within a variable in ascending or descending order. For instance, if you want to arrange the individuals in the <code>rand_sample</code> by income:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sub_data<span class="sc">%&gt;%</span><span class="fu">arrange</span>(income1cpi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,957 × 6
   plantype     female blackhisp   age educper income1cpi
   &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
 1 Catastrophic      1         0    30      11          0
 2 Coinsurance       0         0    53       3          0
 3 Coinsurance       1         0    19      12          0
 4 Free              0         0    36      12          0
 5 Catastrophic      1         0    42      16          0
 6 Coinsurance       1         1    25      11          0
 7 Coinsurance       0         1    35      12          0
 8 Coinsurance       1         0    22      12          0
 9 Free              1         0    34      12          0
10 Free              1         0    50      11          0
# … with 3,947 more rows</code></pre>
</div>
</div>
<p>If you want to arrange by descending order:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sub_data<span class="sc">%&gt;%</span><span class="fu">arrange</span>(<span class="fu">desc</span>(income1cpi))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,957 × 6
   plantype     female blackhisp   age educper income1cpi
   &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
 1 Catastrophic      0        NA    21      15     89132.
 2 Catastrophic      1         0    20      13     89132.
 3 Catastrophic      0        NA    19      13     89132.
 4 Catastrophic      0         0    51      16     89132.
 5 Free              1         0    36      17     79757.
 6 Free              0        NA    14      NA     79757.
 7 Free              0         0    42      17     79757.
 8 Catastrophic      1         0    31      17     78775.
 9 Coinsurance       0         0    40      16     77230.
10 Coinsurance       1         0    40      14     77230.
# … with 3,947 more rows</code></pre>
</div>
</div>
<p>It is also easy to check the top 5 and bottom 10:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sub_data<span class="sc">%&gt;%</span><span class="fu">select</span>(income1cpi)<span class="sc">%&gt;%</span><span class="fu">top_n</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Selecting by income1cpi</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 1
  income1cpi
       &lt;dbl&gt;
1     89132.
2     89132.
3     89132.
4     89132.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sub_data<span class="sc">%&gt;%</span><span class="fu">select</span>(income1cpi)<span class="sc">%&gt;%</span><span class="fu">top_n</span>(<span class="sc">-</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Selecting by income1cpi</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 1
   income1cpi
        &lt;dbl&gt;
 1          0
 2          0
 3          0
 4          0
 5          0
 6          0
 7          0
 8          0
 9          0
10          0
# … with 23 more rows</code></pre>
</div>
</div>
</section>
<section id="filter-mutate-and-ifelse" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="filter-mutate-and-ifelse"><span class="header-section-number">3.2</span> filter(), mutate(), and ifelse()</h2>
<p>Let’s say you only want to work with two types of participants: the ones with either “Free” or “Catastrophic” insurance. To do that, apply the <code>filter()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>cat_vs_free<span class="ot">&lt;-</span>rand_sample<span class="sc">%&gt;%</span><span class="fu">filter</span>(plantype<span class="sc">==</span><span class="st">"Catastrophic"</span><span class="sc">|</span>plantype<span class="sc">==</span><span class="st">"Free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On top of that, you might want to identify the categories with numbers: a dummy variable that takes on one if <code>plantype=="Free"</code> and zero otherwise (you can also think about the dummies we already have for female, nonwhite, etc.). Sometimes, it is just easier to work with numbers than strings. For that task we could use <code>ifelse()</code> together with <code>mutate()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cat_vs_free<span class="ot">&lt;-</span>cat_vs_free<span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">dummy_plan=</span><span class="fu">ifelse</span>(plantype<span class="sc">==</span><span class="st">"Free"</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A few details. <code>ifelse()</code> is base R, and a tidyverse alternative is <code>case_when()</code> - we will talk about it later.</p>
</section>
<section id="exercise-i-racial-discrimination-in-the-labor-market" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="exercise-i-racial-discrimination-in-the-labor-market"><span class="header-section-number">3.3</span> Exercise I: <strong>Racial Discrimination in the Labor Market</strong></h2>
<p>We will use a dataset <a href="https://github.com/guerramarcelino/PolicyEval/raw/main/Datasets/resume.RDS">here</a> from a <a href="https://www.nber.org/papers/w9873">randomized experiment conducted by Marianne Bertrand and Sendhil Mullainathan</a> for this question. The researchers sent 4,870 fictitious resumes out to employers in response to job adverts in Boston and Chicago in 2001. They varied only the names of job applicants while leaving other relevant candidates’ attributes unchanged (i.e., candidates had similar qualifications). Some applicants had distinctly white-sounding names such as Greg Baker and Emily Walsh, whereas other resumes contained stereotypically black-sounding names such as Lakisha Washington or Jamal Jones. Hence, any difference in callback rates can solely be attributed to name manipulation.</p>
<ol type="1">
<li><p>Create a dummy variable named <code>female</code> that takes one if <code>sex=="f"</code>, and zero otherwise.</p></li>
<li><p>The dataset contains information about candidates’ education (<code>education</code>), years of experience (<code>yearsexp</code>), military experience (<code>military</code>), computer and special skills (<code>computerskills</code> and <code>specialskills</code>), a dummy for gender (<code>female</code>), among others. Summarize that information by getting average values by <code>race</code> groups.</p></li>
</ol>
</section>
<section id="exercise-ii-the-tennessee-star-experiment" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="exercise-ii-the-tennessee-star-experiment"><span class="header-section-number">3.4</span> Exercise II: <strong>The Tennessee STAR experiment</strong></h2>
<p>“Education production” is an area much explored by economists. The terminology reflects that we think of features of the school environment as inputs that cost money, while student learning is the output that schools produce. A major question in the field is which inputs have the highest benefit/cost ratio, and one very costly input is class size. An important experiment conducted in Tennessee was designed to precisely answer the question “Does class size impacts student performance?”.&nbsp;</p>
<p><a href="https://www.jstor.org/stable/2587015">Krueger (1999)</a> analyzed the Project STAR, a longitudinal study that randomly assigned kindergarten students and their teachers to one of three groups beginning in the 1985–1986 school year. The three groups were small classes (13–17 students per teacher), regular-size classes (22–25 students), and regular/aide classes (22–25 students) which also included a full-time teacher’s aide. After their initial assignment, the design called for students to remain in the same class type for four years. Some 6000–7000 students were involved in the project each year. You can find part of the sample related to students who entered STAR in kindergarten <a href="https://github.com/guerramarcelino/PolicyEval/raw/main/Datasets/STARkinder.RDS">here</a> to answer the following questions.</p>
<p>1. Create the dummy variables <code>Free_lunch</code> (takes 1 if <code>lunch</code> is “free”), <code>White_asian</code> (equal 1 if ethnicity is either “cauc” or “asian”) and <code>Female</code> - takes 1 if gender is “female”. Also, define the variable <code>age</code> as 1986-<code>birth</code>, i.e., compute the age of the children in 1986.</p>
<p>2. The first question to ask about a randomized experiment is whether the randomization successfully balanced the subject’s characteristics across different groups. Although the STAR data failed to include any pretreatment test scores, we can look at some characteristics of students such as race, gender, age, and free lunch status, which is a good measure of family income since only poor children qualify for free school lunch. Compare the values of <code>Free_lunch</code>, <code>White_asian</code>, <code>Female</code>, and <code>age</code> across the three groups <code>small</code>, <code>regular</code>, <code>regular+aide</code>. Do these variables look balanced?</p>
</section>
<section id="merging-datasets" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="merging-datasets"><span class="header-section-number">3.5</span> Merging datasets</h2>
<p>Sometimes you get information from different sources but want to analyze all together. When that happens, one can use <code>merge()</code> or the many “joins” available on <code>tidyverse()</code>. Say you want to put together two datasets: one with socioeconomic information about counties (<a href="https://piazza.com/redirect/s3?bucket=uploads&amp;prefix=paste%2Fjlcuq2vjsa37nw%2Ff017c7fa505fac343d1f9e57808d82d7dcaef3e648e9e0fa58ef8b80bf6dd29c%2FHHincome18.csv">here</a>) and another that has health indicators also at the county level (<a href="https://github.com/guerramarcelino/UrbanEconomics/raw/master/Datasets/health_data.RDS">here</a>) The first step is to load both of them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>HHincome<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"HHincome18.csv"</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>) <span class="do">## col_names is TRUE because all the columns have names in the first row</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>health_data<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"health_data.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A few details here. Since the <code>.csv</code> file has column names, we have <code>col_names=T</code>. Also, the function <code>read_csv()</code> belongs to <code>tidyverse</code> and you need to call the package first.</p>
<p>To put the two datasets (income and health) together, you can use <code>join</code> function. <strong>There are some details here</strong>. You have 3,275 counties (rows) in <code>HHincome</code>, but only 3,141 counties in <code>health_data</code>. Here I will use <code>left_join</code> restricting the merge to those 3,141 counties inside <code>health_data</code>. Check the other join types <a href="https://dplyr.tidyverse.org/reference/join.html">here</a>. Using the function <code>dim()</code> you will realize that your new data has 3,141 rows and 9 columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>full_data<span class="ot">&lt;-</span><span class="fu">left_join</span>(health_data, HHincome,<span class="at">by =</span> <span class="st">"FIPStxt"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(full_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3141    9</code></pre>
</div>
</div>
</section>
<section id="drop_na-and-replace_na" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="drop_na-and-replace_na"><span class="header-section-number">3.6</span> drop_na() and replace_na()</h2>
<p>You will frequently face datasets that have columns with missing information. Sometimes, you need to replace NAs by zero, sometimes you drop the entire row and ignore that unit of observation. Let’s see how that works. First, create a new “full_data” but this time using the <code>right_join()</code> . Can you explain the difference between these joins?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>full_data2<span class="ot">&lt;-</span><span class="fu">right_join</span>(health_data, HHincome,<span class="at">by =</span> <span class="st">"FIPStxt"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#View(full_data2)</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(full_data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3275    9</code></pre>
</div>
</div>
<p>Now you have 3,275 counties, but some of them do not have health indicators and you might want to drop these places:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>full_data2<span class="ot">&lt;-</span>full_data2<span class="sc">%&gt;%</span><span class="fu">drop_na</span>()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(full_data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3134    9</code></pre>
</div>
</div>
<p>To replace <code>NAs</code> by zero (or something else) instead, check <a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a>.</p>
</section>
<section id="exercise-iii-in-and-notin-more-summarize" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="exercise-iii-in-and-notin-more-summarize"><span class="header-section-number">3.7</span> Exercise III: <code>%in%</code> and <code>%notin%</code> more summarize()</h2>
<p>1. Instead of using <code>%in%</code>, you might want to try <code>%notin%</code>. Base R does not provide a <code>%notin%</code> function, so we will need to create it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%notin%</span><span class="st">`</span><span class="ot">&lt;-</span><span class="fu">Negate</span>(<span class="st">`</span><span class="at">%in%</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And here is the question: which counties in <code>full_data</code> are not in <code>full_data2</code>?</p>
<p>2. Using <code>full_data2</code>, get the top 5 and bottom 10 <strong>counties</strong> in terms of <strong>% of people eligible for Medicare</strong>. Check also the top 5 and bottom 10 <strong>states</strong> concerning the <strong>total ICU beds</strong>.</p>
<p><em>Hint:</em> The column <code>EligibleforMedicare18</code> refers to the number of people eligible for Medicare per county in 2018. Note that you also have the estimated 2018 population (<code>PopulationEstimate2018</code> column).</p>
</section>
<section id="group_by-and-ungroup" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="group_by-and-ungroup"><span class="header-section-number">3.8</span> group_by() and ungroup()</h2>
<p>We already saw how <code>group_by</code> works. But what if you want to preserve your dataset but add a new column with some group level information? For instance, what if you want to add a column with state-level information about total ICU beds?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>full_data2<span class="ot">&lt;-</span>full_data2<span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(StateName)<span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">StateICU=</span><span class="fu">sum</span>(ICU_beds)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercise-iv-airbnb-and-chicago-communities" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="exercise-iv-airbnb-and-chicago-communities"><span class="header-section-number">3.9</span> Exercise IV: Airbnb and Chicago Communities</h2>
<p>The first dataset <a href="https://github.com/guerramarcelino/UrbanEconomics/raw/master/Datasets/airbnb.RDS">Airbnb.RDS</a> refers to Airbnb rentals, socioeconomic indicators, and crime by community area in Chicago. The <a href="https://github.com/guerramarcelino/UrbanEconomics/raw/master/Datasets/communities.xls">Communities.xls</a> file contains health and socioeconomic indicators for the 77 community areas of Chicago, 2012-2014.</p>
<ol type="1">
<li><p>Import both datasets and use <code>View()</code> to check them.</p></li>
<li><p>Merge the datasets using the function <code>full_join()</code>. What is the dimension of your new dataset? What variables do they have in common (variables with the same column name)?</p></li>
</ol>
<p><strong>The <code>Airbnb</code> data has the columns <code>area</code> and <code>dist</code>. They represent the total community area and the distance (in km) from the community to Chicago downtown, respectively.</strong></p>
<ol start="3" type="1">
<li><p>You want to work only with the following columns: <code>community</code>, <code>price_pp</code>, <code>num_spots</code>, <code>rev_rating</code>, <code>PerCInc14</code> , <code>num_theft</code>, <code>FirearmM</code> ,<code>unemployed</code>, <code>harship_in</code>, <code>Pop2014</code>, <code>BirthRate</code>, <code>Over65</code>, <code>dist</code>, and <code>area</code>. Select only those variables and store them in a new data frame.</p></li>
<li><p>Create the new variable <code>theft_rate</code> dividing the total number of thefts by the <strong>population in 2014</strong>.</p></li>
<li><p>First, divide the total population in 2014 by the community’s area to get values for population density (number of people per square mile). Then, create the new variable <code>logdens</code>, taking the natural logarithm of population density.</p></li>
<li><p>Filter your new dataset to identify <strong>Central Chicago</strong>. In other words, you want to filter communities within 3km from Chicago downtown. What is the average number of Airbnb spots in Central Chicago? What are the average Airbnb prices, per capita income, theft rate, firearm-related deaths, population density, and birth rate in Central Chicago?</p></li>
<li><p>Finally, compare the values for the same variables in Central Chicago with the average numbers from <strong>Far from downtown</strong> - the communities that have a distance from downtown higher than 19 km.</p></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./start.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started with R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./vizi.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with Tidyverse</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>